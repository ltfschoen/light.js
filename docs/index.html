<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl">
  <title data-ice="title">Home | @parity/light.js</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A high-level reactive JS library optimized for light clients"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="@parity/light.js"><meta property="twitter:description" content="A high-level reactive JS library optimized for light clients"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/parity-js/light.js"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getApi">getApi</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setApi">setApi</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#frequency">frequency</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-onAccountsChanged$">onAccountsChanged$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-onAccountsInfoChanged$">onAccountsInfoChanged$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-onEvery2Blocks$">onEvery2Blocks$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-onEvery4Blocks$">onEvery4Blocks$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-onEveryBlock$">onEveryBlock$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-onNodeHealthChanged$">onNodeHealthChanged$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-onSyncingChanged$">onSyncingChanged$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-onStartup$">onStartup$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-onEvery2Seconds$">onEvery2Seconds$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-onEverySecond$">onEverySecond$</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#rpc-eth">rpc/eth</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-accounts$">accounts$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-balanceOf$">balanceOf$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-blockNumber$">blockNumber$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-defaultAccount$">defaultAccount$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-height$">height$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-me$">me$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-myBalance$">myBalance$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-syncing$">syncing$</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#rpc-other">rpc/other</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-post$">post$</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#rpc-parity">rpc/parity</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-accountsInfo$">accountsInfo$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-chainName$">chainName$</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-nodeHealth$">nodeHealth$</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils">utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isLoading">isLoading</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isNullOrLoading">isNullOrLoading</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RPC_LOADING">RPC_LOADING</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><div data-ice="index" class="github-markdown"><h1 id="-parity-light-js">@parity/light.js</h1><p>A high-level reactive JS library optimized for light clients.</p>
<h2 id="getting-started">Getting Started</h2><pre><code class="lang-bash"><code class="source-code prettyprint">yarn install @parity/light.js</code>
</code></pre>
<h2 id="usage">Usage</h2><p>Reactively observe JSONRPC methods:</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">import { defaultAccount$ } from &apos;@parity/light.js&apos;;

defaultAccount$().subscribe(publicAddress =&gt; console.log(publicAddress));
// Outputs your public address 0x...
// Everytime you change your default account (e.g. via MetaMask), it will output your new public address</code>
</code></pre>
<p>All RxJS tools are available for manipulating Observables:</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">import { balanceOf$, blockNumber$, defaultAccount$ } from &apos;@parity/light.js&apos;;
import { filter, map, switchMap } from &apos;rxjs/operators&apos;;

// Only log pair blocks
blockNumber$()
  .pipe(filter(n =&gt; n % 2 === 0))
  .subscribe(console.log);

// Get the balance of the default account
// Will update when balance or default account changes
defaultAccount$()
  .pipe(
    switchMap(balanceOf$),
    map(value =&gt; +value) // Return number instead of BigNumber
  )
  .subscribe(console.log);

// There&apos;s actually an alias for the above Observable:
import { myBalance$ } from &apos;@parity/light.js&apos;;
myBalance$().subscribe(console.log);</code>
</code></pre>
<p>Contract support:</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">import { defaultAccount$, makeContract$ } from &apos;@parity/light.js&apos;;
import { map, switchMap } from &apos;rxjs/operators&apos;;

defaultAccount$()
  .pipe(
    switchMap(defaultAccount =&gt;
      makeContract$(/* contract address */, /* abi */)
        .myMethod(defaultAccount) // Calling method of contract with arguments
    )  )
  .subscribe(console.log); // Will log the result, and everytime the result changes</code>
</code></pre>
<p>All available methods are documented <a href="https://parity-js.github.io/light.js/">in the docs</a>.</p>
<h2 id="usage-with-react">Usage with React</h2><p>The libray provides a higher-order component to use these Observables easily with React apps.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">import light from &apos;???&apos;; // ??? to be decided
import { syncing$ } from &apos;@parity/light.js&apos;;

@light({
  syncingVariable: syncing$
})
class MyClass extends React.Component {
  render() {
    return &lt;div&gt;{JSON.stringify(this.props.syncingVariable)}&lt;/div&gt;;
  }
}</code>
</code></pre>
<p>The UI will automatically update when the syncing state changes.</p>
<h2 id="advanced-usage">Advanced Usage</h2><h3 id="frequency">Frequency</h3><p>Each Observable has a frequency upon which it is called. The frequency is documented in each method&apos;s <a href="https://parity-js.github.io/light.js/">documentation</a>.</p>
<p>For example, the frequency of <code>balanceOf$</code> is:</p>
<p><code>frequency: [onStartup$, onEvery2Blocks$]</code></p>
<p>which means that the underlying JSONRPC call <code>eth_getBalance</code> will be made once when the Observable is subscribed (on startup), and once every 2 blocks.</p>
<p>For the needs of your dapp, you can change the frequency of all Observables like this:</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">import { balanceOf$, onEvery2Seconds$, onStartup$ };

balanceOf$.setFrequency([onStartup$, onEvery2Seconds$]);
balanceOf$(&apos;0x123&apos;).subscribe(console.log);
// `eth_getBalance` will be called once immediately, and once every 2 seconds</code>
</code></pre>
<p>A list of possible frequency Observables is here [TODO doc link], but you can of course put any array of Observables you want.</p>
<h3 id="rpc-overview">RPC Overview</h3><p>To see an overview of all currently active Observables, type <code>window.parity.rpcOverview()</code> in the browser console. The output will be:</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">{
  accounts$: {
    calls: [&apos;eth_accounts&apos;],
    frequency: [&apos;onAccountsChanged$&apos;],
    subscribersCount: 4
  },
  balanceOf$: {
    calls: [&apos;eth_getBalance&apos;],
    frequency: [&apos;onEvery2Blocks$&apos;, &apos;onStartup$&apos;],
    subscribersCount: 2
  },
  defaultAccount$: {
    dependsOn: [&apos;accounts$&apos;],
    subscribersCount: 3
  },
  height$: {
    frequency: [&apos;onEveryBlock$&apos;],
    subscribersCount: 2
  },
  me$: {
    dependsOn: [&apos;defaultAccount$&apos;],
    subscribersCount: 1
  },
  syncing$: {
    frequency: [&apos;onSyncingChanged$&apos;],
    subscribersCount: 1
  }
}</code>
</code></pre>
<p>The keys are the Observables you are using in your dapp, each containing an object where:</p>
<ul>
<li><code>calls</code>: the underlying JSONRPC calls made.</li>
<li><code>dependsOn</code>: means that the current Observable depends on other Observables, so it doesn&apos;t make any JSONRPC calls itself, and doesn&apos;t have a frequency.</li>
<li><code>frequency</code>: the frequency upon which the Observable is called.</li>
<li><code>subscribersCount</code>: the number of subscribers this Observable has.</li>
</ul>
<p>This output can of course be different on different pages of your dapp, if they use different Observables.</p>
<h2 id="notes-about-implementation">Notes about Implementation</h2><h3 id="observables-are-cold">Observables are cold</h3><p>The underlying JSONRPC method is only called if there&apos;s at least one subscriber.</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">import { balanceOf$ } from &apos;@parity/light.js&apos;;

const myObs$ = balanceOf$(&apos;0x123&apos;);
// Observable created, but `eth_getBalance` not called yet
const subscription = myObs$.subscribe(console.log);
// `eth_getBalance` called for the 1st time

// Some other code...

subscription.unsubscribe();
// `eth_getBalance` stops being called</code>
</code></pre>
<h3 id="observables-are-publishreplay-1-">Observables are PublishReplay(1)</h3><p>Let&apos;s take <code>blockNumber()$</code> which fires blocks 7, 8 and 9, and has 3 subscribers that don&apos;t subscribe at the same time.</p>
<p>We have the following marble diagram (<code>^</code> denotes when the subscriber subscribes).</p>
<pre><code><code class="source-code prettyprint">blockNumber$(): -----7----------8------9-----|
subscriber1:    -^---7----------8------9-----|
subscriber2:    ------------^7--8------9-----|
subscriber3:    --------------------------^9-|</code>
</code></pre><p>Note: the default behavior for Observables is without PublishReplay, i.e.</p>
<pre><code><code class="source-code prettyprint">blockNumber$(): -----7----------8------9-----|
subscriber1:    -^---7----------8------9-----|
subscriber2:    ------------^---8------9-----|
subscriber3:    --------------------------^--|</code>
</code></pre><p>But Observables in this library are PublishReplay(1). <a href="https://blog.angularindepth.com/rxjs-how-to-use-refcount-73a0c6619a4e">Read more</a> about PublishReplay.</p>
<h3 id="observables-are-memoized">Observables are memoized</h3><pre><code class="lang-javascript"><code class="source-code prettyprint">const obs1$ = balanceOf$(&apos;0x123&apos;);
const obs2$ = balanceOf$(&apos;0x123&apos;);
console.log(obs1$ === obs2$); // true

const obs3$ = balanceOf$(&apos;0x456&apos;);
console.log(obs1$ === obs3$); // false</code>
</code></pre>
<h3 id="underlying-api-calls-are-not-unnessarily-repeated">Underlying API calls are not unnessarily repeated</h3><pre><code class="lang-javascript"><code class="source-code prettyprint">const obs1$ = balanceOf$(&apos;0x123&apos;);
const obs2$ = balanceOf$(&apos;0x123&apos;);

obs1$.subscribe(console.log);
obs1$.subscribe(console.log);
obs2$.subscribe(console.log);
// Logs 3 times the balance
// But only one call to `eth_getBalance` has been made

const obs3$ = balanceOf$(&apos;0x456&apos;);
// Logs a new balance, another call to `eth_getBalance` is made</code>
</code></pre>
<h3 id="underlying-pubsub-subscriptions-are-dropped-when-there--39-s-no-subscriber">Underlying PubSub subscriptions are dropped when there&apos;s no subscriber</h3><pre><code class="lang-javascript"><code class="source-code prettyprint">import { blockNumber$ } from &apos;@parity/light.js&apos;;

const myObs$ = blockNumber$();
console.log(blockNumber$.frequency); // [onEveryBlock$]
// Note: onEveryBlock$ creates a pubsub on `eth_blockNumber`

const subscription = myObs$.subscribe(console.log);
// Creates a pubsub subscription

// Some other code...

subscription.unsubscribe();
// Drops the pubsub subscription</code>
</code></pre>
<h2 id="todo">TODO</h2><ul>
<li>Don&apos;t commit <code>lib/</code> anymore, when it&apos;s on npm.</li>
<li>Switch to TypeScript.</li>
<li>Have 100% test coverage.</li>
</ul>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
